//yibai ???????§³???
#include <stdio.h>
#include <stdlib.h>
#include <conio.h>
#include <windows.h>
#include <time.h>
#include <string.h>

void HideCursor();         //??????
void gotoxy(int x, int y); //???¦Ë

#define R 26 //?????????¦Âx????????
#define N 20 //??????

int ax[3] = {0};       //???????¦Â???????
int y[3] = {3, 7, 11}; //????y???????????????????y??¦Ë??
                       //??????????§à???????¦Ì????????????????????????y??????????
int i;                 //????????
int fd[3];             //??????????

void cshcxhs() //?????????
{
    system("title ????§³???");         //????
    system("mode con cols=100 lines=30"); //??100????30
    HideCursor();                         //???????

    gotoxy(46, 12); //???????????
    printf("???????");
    gotoxy(36, 14);
    printf("w a d???????????????????");
    gotoxy(26, 16);
    printf("???§Ö§à???? |---0> ???????????????? >>>>>> ?????");
    gotoxy(40, 18);
    printf("???¡Â? %d ???????", N);
    Sleep(3000);

    system("cls");

    int k;         //????????
    gotoxy(40, R); //????????
    for (k = 0; k < 17; k++)
        printf("_");

    gotoxy(46, R);
    printf("[ 0 ]");
    gotoxy(48, 25); //?§Þ?x??48
    printf("|");

    int j;
    srand((unsigned)time(NULL)); //????????????
    for (j = 0; j < 3; j++)      //????????????x????§Õ????????
    {
        ax[j] = rand() % R;
        fd[j] = rand() % 2;
    }

    gotoxy(0, R);
    printf("  ?¡Â??"); //????x????9
}

void hcfjhs() //???????????
{
    gotoxy(ax[i], y[i]); //????????¦Â???????????

    if (fd[i] == 1)
        printf("|---->");
    else
        printf(">>>>>>");

    gotoxy(ax[i] - 1, y[i]); //??????¦Â?????????
    printf(" ");

    ax[i]++; //?????¦Â?????????????????¦Â?????????
}

void dhpdxshs() //????????????¡Â??????x94????????
{
    for (i = 0; i < 3; i++) //????????????
    {
        hcfjhs();

        if (ax[i] + 6 >= 94) //?§Ø???????????§Ô???94
        {
            gotoxy(94, y[i]); //?????????????????94????????
            printf("      ");
            if (ax[i] + 6 > 100) //??????????????100????????????????
            {
                ax[i] = rand() % R; //????§³??R???????
                fd[i] = rand() % 2;
            }
        }
    }
}

int da = 2;   //da = 1????? ????§Þ? ?????????????
int yip = 0;  //??????0??????1??2??3????????
int rtde = 1; //?????????????????????????

int shells_x; //???????
int shells_y;

void ckkzhs()
{
    char ch;
    ch = _getch();

    if (ch == 'd' || ch == 'D')
    {
        gotoxy(49, 25);
        printf("/"); //??????
        gotoxy(47, 25);
        printf("  ");
        da = 3; //??????
    }
    if (ch == 'A' || ch == 'a')
    {
        gotoxy(47, 25);
        printf("\\"); //?????????
        gotoxy(48, 25);
        printf("  ");
        da = 1; //??????
    }
    if (ch == 'W' || ch == 'w')
    {
        gotoxy(48, 25);
        printf("|");
        gotoxy(47, 25);
        printf(" ");
        gotoxy(49, 25);
        printf(" ");
        da = 2;
    }

    if (ch == ' ' && rtde == 0) //????????????????????????
    {
        if (da == 2) //??  ???????
            yip = 2;

        if (da == 1) //??
        {
            yip = 1;
            shells_x = 45; //??????????????
        }
        if (da == 3) //??
        {
            yip = 3;
            shells_x = 51;
        }
        shells_y = 23; //??????????????
    }
}

void dpfshs() //??????????????????
{
    rtde = 1; //????????????????¦Ä???????
    if (yip == 2)
    {
        shells_x = 48;
        gotoxy(shells_x, shells_y -= 2);
        printf("o");
        gotoxy(shells_x, shells_y + 2);
        printf(" ");
    }
    if (yip == 1)
    {
        gotoxy(shells_x -= 2, shells_y -= 2);
        printf("o");
        gotoxy(shells_x + 2, shells_y + 2);
        printf(" ");
    }
    if (yip == 3)
    {
        gotoxy(shells_x += 2, shells_y -= 2);
        printf("o");
        gotoxy(shells_x - 2, shells_y + 2);
        printf(" ");
    }

    if (shells_y <= 1) //?????íà???????
    {
        yip = 0;       //?????íà??????
        gotoxy(48, 1); //??????
        printf(" ");
        gotoxy(23, 1);
        printf(" ");
        gotoxy(73, 1);
        printf(" ");
        rtde = 0; //?????íà?????????????????????
    }
}

int score; //?¡Â?

void pdfsjzhs() //?§Ø??????§Ü???????
{

    for (i = 0; i < 3; i++)
    {
        if (shells_x >= ax[i] && shells_x <= ax[i] + 6 && shells_y == y[i]) //?????
        {
            if (fd[i] == 1)
                score++; //??????¦²??¡Â???
            else
            {
                score--;
                if (score <= 0)
                    score = 0;
            }

            rtde = 0; //??????????????

            gotoxy(ax[i] - 1, y[i]); //???§Ü???????¦Â??????????
            printf("      ");

            ax[i] = rand() % R; //????§³??10???????
            fd[i] = rand() % 2; //??????????£

            gotoxy(shells_x, shells_y); //????§Ù??????????????????????
            printf(" ");

            shells_x = 0, shells_y = 0; //??????§Ù?????????íà????¦Ï?????????????
        }
    }

    gotoxy(9, R);
    printf("%d", score);

    if (score >= N) //????????§Ø?
    {
        system("cls"); //????
        gotoxy(39, 15);
        printf("????????????¡Â??%d !", N);
        gotoxy(0, 29);
        exit(0);
    }
}

void process() //????
{
    while (1)
    {
        dhpdxshs(); //???????????

        if (_kbhit())
        {
            ckkzhs(); //????????
        }

        dpfshs();   //????§¹??????
        pdfsjzhs(); //?§Ø??????§Ü???????

        Sleep(18);
    }
}

int main()
{
    cshcxhs(); //?????????

    process(); //????

    return 0;
}

void HideCursor()
{
    CONSOLE_CURSOR_INFO cursor_info = {1, 0};
    SetConsoleCursorInfo(GetStdHandle(STD_OUTPUT_HANDLE), &cursor_info);
}

void gotoxy(int x, int y)
{
    COORD pos = {x, y};
    SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), pos);
}